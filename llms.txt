# DeepCitation

> **Note**: The product name is **DeepCitation** (not "DeepCite"). Always use "DeepCitation" when referring to the product, package, or API.

> Deterministic AI citation verification. Eliminate hallucination risk by proving every AI citation against attachments.

DeepCitation is an open-source library and API that enables AI applications to include verifiable, traceable citations. Every citation is deterministically matched to its exact location in attachments with visual proof generation.

## Core Concepts

- **Deterministic Matching**: Citations are traced to exact locations in attachments. No fuzzy matching or guessing—just deterministic proof.
- **Visual Proof**: Automated screenshots with highlighted text show exactly where each citation comes from.
- **LLM Agnostic**: Works with any LLM provider—OpenAI, Anthropic, Google, or custom models.
- **React Components**: Pre-built and composable components for rendering citations with verification status.

## Integration Workflow

DeepCitation works in three steps:

1. **Pre-Prompt**: Upload attachments and enhance your LLM prompt with citation instructions using `prepareFiles()` and `wrapCitationPrompt()`.
2. **Post-Prompt**: After receiving the LLM response, verify citations against attachments using `verify()`.
3. **Display**: Render verified citations with React components like `CitationComponent`.

## Documentation

- [README](https://github.com/deepcitation/deepcitation-js#readme): Full documentation with installation, quick start, and API reference
- [Get API Key](https://deepcitation.com/signup): Sign up for a free API key (no credit card required)
- [API Documentation](https://docs.deepcitation.com/): Complete API reference and guides

## Installation

```bash
npm install @deepcitation/deepcitation-js
# or yarn add / bun add
```

## Key Exports

```typescript
// Core client and utilities
import { DeepCitation, wrapCitationPrompt, getAllCitationsFromLlmOutput } from "@deepcitation/deepcitation-js";

// React components
import { CitationComponent, ChipCitation, SuperscriptCitation } from "@deepcitation/deepcitation-js/react";

// Types
import type { Citation, Verification } from "@deepcitation/deepcitation-js";
```

## API Reference

### DeepCitation Client

- `new DeepCitation({ apiKey })` - Initialize the client with your API key
- `prepareFiles(files)` - Upload attachments and get structured content for LLM prompts
- `verify(attachmentId, citations)` - Verify pre-parsed citations against a specific file

### Prompt Utilities

- `wrapCitationPrompt({ systemPrompt, userPrompt, deepTextPromptPortion })` - Wrap prompts with citation instructions and optionally include file content
- `wrapSystemCitationPrompt({ systemPrompt })` - Wrap only system prompt (for more control)
- `getAllCitationsFromLlmOutput(text)` - Extract citations from LLM response
- `replaceCitations(text, options)` - Replace citation tags with optional verification status indicators
- `groupCitationsByAttachmentId(citations)` - Group citations by attachmentId for multi-file verification

### React Components

`CitationComponent` is the main component for rendering citations. Use the `variant` prop to change visual style:

| Variant       | Description                                              |
|---------------|----------------------------------------------------------|
| `brackets`    | Classic bracket style `[1✓]` (default)                   |
| `chip`        | Pill/badge style with background color                   |
| `text`        | Plain text, inherits parent styling                      |
| `superscript` | Academic superscript style like footnotes¹               |
| `linter`      | Inline text with semantic underlines (grammar-check style) |

The `linter` variant uses underline styles to convey verification status:
- **Verified**: Solid underline with subtle green background
- **Partial**: Dashed underline (amber)
- **Not Found**: Wavy underline (red) - familiar from spell-checkers
- **Pending**: Dotted underline (gray)

### Composable Primitives

Build custom citation components with `Citation.Root`, `Citation.Trigger`, `Citation.Bracket`, `Citation.Number`, `Citation.KeySpan`, `Citation.Indicator`, `Citation.Status`, `Citation.Phrase`, and `Citation.Page`.

## Supported File Types

### Direct Upload
- PDF documents (native and scanned with OCR)
- Images (PNG, JPEG, TIFF, WebP, AVIF, HEIC)

### URL Conversion (via `convertToPdf()`)
- Web pages (HTML rendered to PDF)
- Direct PDF links

### Office Documents (via `convertToPdf()`)
- Microsoft Word: `.doc`, `.docx`
- Microsoft Excel: `.xls`, `.xlsx`
- Microsoft PowerPoint: `.ppt`, `.pptx`
- OpenDocument: `.odt`, `.ods`, `.odp`
- Rich Text Format: `.rtf`
- CSV: `.csv`

## Converting URLs and Office Files

For URLs or Office documents, use `convertToPdf()` followed by `prepareConvertedFile()`:

```typescript
const deepcitation = new DeepCitation({ apiKey: process.env.DEEPCITATION_API_KEY });

// Convert a URL to PDF
const result = await deepcitation.convertToPdf("https://example.com/article");

// Or convert an Office document
const result = await deepcitation.convertToPdf({
  file: docxBuffer,
  filename: "report.docx"
});

// Then prepare for citation verification
const { deepTextPromptPortion, attachmentId } = await deepcitation.prepareConvertedFile({
  attachmentId: result.attachmentId
});

// Use deepTextPromptPortion in LLM prompt, then verify citations
const verified = await deepcitation.verifyCitations(attachmentId, citations);
```

### `convertToPdf(input)`
- Input: URL string, or object with `{ url?, file?, filename?, attachmentId? }`
- Returns: `{ attachmentId, metadata, status }`

### `prepareConvertedFile(options)`
- Input: `{ attachmentId }`
- Returns: Same as `uploadFile()` - `{ deepTextPromptPortion, attachmentId, ... }`

## Optional

- [GitHub Issues](https://github.com/deepcitation/deepcitation-js/issues): Report bugs or request features
- [Contributing Guide](https://github.com/deepcitation/deepcitation-js#contributing): How to contribute to the project
